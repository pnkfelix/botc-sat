<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TypeScript SATSolver Browser Test</title>
</head>
<body>
    <h1>TypeScript SATSolver with JSMiniSolvers Test</h1>
    <div id="status">Testing...</div>
    <div id="result"></div>
    
    <script src="./vendor/minisolvers.js"></script>
    
    <script>
        // Simplified version of our SATSolver class for browser testing
        class SATSolver {
            constructor() {
                this.variableMap = new Map();
                this.nextVarId = 1;
            }

            async solve(constraints) {
                console.log("Solving constraints:", constraints);
                
                if (typeof minisolvers !== 'undefined') {
                    return this.solveWithJSMiniSolvers(constraints);
                } else {
                    console.log("JSMiniSolvers not available, using mock solver");
                    return this.solveMock(constraints);
                }
            }

            solveWithJSMiniSolvers(constraints) {
                const solver = new minisolvers.MinisatSolver();
                
                const clauses = this.convertConstraintsToCNF(constraints);
                
                // Add variables to solver
                for (let i = 1; i <= this.nextVarId - 1; i++) {
                    solver.new_var();
                }
                
                // Add clauses to solver
                for (const clause of clauses) {
                    solver.add_clause(clause);
                }
                
                const isSat = solver.solve();
                
                if (isSat) {
                    const rawModel = solver.get_model();
                    const model = {};
                    for (const [varName, varId] of this.variableMap.entries()) {
                        model[varName] = rawModel[varId - 1]; // MiniSat uses 1-based, array is 0-based
                    }
                    return { satisfiable: true, model };
                } else {
                    return { satisfiable: false };
                }
            }

            solveMock(constraints) {
                const model = {};
                for (const constraint of constraints) {
                    const parsed = this.parseConstraint(constraint);
                    if (parsed) {
                        model[parsed.variable] = parsed.value;
                    }
                }
                return { satisfiable: true, model };
            }

            parseConstraint(constraint) {
                if (constraint.includes('=')) {
                    const [variable, value] = constraint.split('=').map(s => s.trim());
                    return { variable, value: value === 'true' };
                }
                return null;
            }

            getVariableId(variable) {
                if (!this.variableMap.has(variable)) {
                    this.variableMap.set(variable, this.nextVarId++);
                }
                return this.variableMap.get(variable);
            }

            convertConstraintsToCNF(constraints) {
                const clauses = [];
                
                for (const constraint of constraints) {
                    const parsed = this.parseConstraint(constraint);
                    if (parsed) {
                        const varId = this.getVariableId(parsed.variable);
                        clauses.push([parsed.value ? varId : -varId]);
                    }
                }
                
                return clauses;
            }
        }

        async function testTypeScriptSolver() {
            const statusEl = document.getElementById('status');
            const resultEl = document.getElementById('result');
            
            try {
                statusEl.textContent = 'Testing TypeScript SATSolver with JSMiniSolvers...';
                
                const solver = new SATSolver();
                const result = await solver.solve(['x=true', 'y=false']);
                
                statusEl.textContent = 'SUCCESS: TypeScript SATSolver working in browser!';
                resultEl.innerHTML = `
                    <strong>SAT Solver Results:</strong><br>
                    Satisfiable: ${result.satisfiable}<br>
                    Model: ${JSON.stringify(result.model, null, 2)}<br>
                    <em>TypeScript SATSolver using JSMiniSolvers backend!</em>
                `;
                
            } catch (error) {
                statusEl.textContent = 'Error testing TypeScript SATSolver:';
                resultEl.textContent = error.message;
                console.error('TypeScript SATSolver test failed:', error);
            }
        }
        
        testTypeScriptSolver();
    </script>
</body>
</html>